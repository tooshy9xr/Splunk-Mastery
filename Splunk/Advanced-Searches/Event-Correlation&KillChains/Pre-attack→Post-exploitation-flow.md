# ğŸ”¥ Pre-Attack â†’ Post-Exploitation Detection Flow
## Linux â€¢ Windows â€¢ Cloud (Advanced Splunk Searches)

This document provides an **end-to-end detection framework** that tracks attacker behavior from **pre-attack reconnaissance** to **post-exploitation impact** across **Linux systems, Windows environments, and Cloud platforms (AWS, Azure, GCP)**.

Designed for:
- Advanced SOC Analysts
- Threat Detection Engineers
- Incident Responders
- Splunk Mastery â€“ Advanced Searches

---

## ğŸ¯ Objectives
- Detect early-stage attacker behavior
- Correlate identity, host, and cloud activity
- Track attacker progression across the kill chain
- Identify data exfiltration and destructive actions
- Support advanced incident response workflows

---

## ğŸ§  Attack Flow Overview

| Phase | Description |
|------|------------|
| Pre-Attack | Reconnaissance and enumeration |
| Initial Access | Credential abuse or exploitation |
| Privilege Escalation | Elevated permissions gained |
| Lateral Movement | Access expansion |
| Command & Control | Remote control established |
| Post-Exploitation | Exfiltration, persistence, impact |

---

## ğŸŸ¡ PRE-ATTACK: Reconnaissance & Enumeration

### ğŸ” Linux â€“ Suspicious Recon Commands
```spl
index=linux_logs
(command IN ("whoami","id","uname","hostname","ip a","ifconfig","netstat","ss"))
| stats count by host user command
```

### ğŸ” Windows â€“ Discovery Commands
```spl
index=windows_logs
(EventCode=4688)
(CommandLine="*whoami*" OR CommandLine="*net user*" OR CommandLine="*ipconfig*")
| table _time host user CommandLine
```

### ğŸ” Cloud â€“ IAM / Permission Enumeration
```spl
index=cloud_logs
(eventName IN ("ListBuckets","GetIamPolicy","ListRoleAssignments"))
| stats count by user sourceIPAddress
```

---

## ğŸ”´ INITIAL ACCESS: Credential Abuse / Exploitation

### ğŸ”‘ Linux â€“ Suspicious SSH Logins
```spl
index=linux_logs
(message="Accepted password*" OR message="Accepted publickey*")
| stats count by user src_ip
```

### ğŸ”‘ Windows â€“ Suspicious Logons
```spl
index=windows_logs
(EventCode=4624 LogonType IN (3,10))
| stats count by Account_Name Source_Network_Address
```

### ğŸ”‘ Cloud â€“ Console / API Login
```spl
index=cloud_logs
(eventName IN ("ConsoleLogin","SignInLogs","GenerateAccessToken"))
| table _time user sourceIPAddress eventName
```

---

## ğŸŸ  PRIVILEGE ESCALATION

### â¬†ï¸ Linux â€“ Sudo Abuse
```spl
index=linux_logs
(command="sudo*" AND user!="root")
| table _time host user command
```

### â¬†ï¸ Windows â€“ Privilege Assignment
```spl
index=windows_logs
(EventCode=4672)
| table _time host Account_Name Privileges
```

### â¬†ï¸ Cloud â€“ Role / Policy Changes
```spl
index=cloud_logs
(eventName IN ("AttachUserPolicy","AddMemberToRole","SetIamPolicy"))
| table _time user target resource
```

---

## ğŸ”µ LATERAL MOVEMENT

### ğŸ” Linux â€“ Remote Execution
```spl
index=linux_logs
(command IN ("ssh","scp","rsync"))
| stats count by user dest_host
```

### ğŸ” Windows â€“ Remote Services
```spl
index=windows_logs
(EventCode=4688)
(CommandLine="*psexec*" OR CommandLine="*wmic*" OR CommandLine="*winrm*")
| table _time host user CommandLine
```

### ğŸ” Cloud â€“ Cross-Resource Access
```spl
index=cloud_logs
(eventName IN ("AssumeRole","GetAccessToken"))
| stats count by user target_resource
```

---

## ğŸŸ£ COMMAND & CONTROL (C2)

### ğŸ“¡ Linux â€“ Suspicious Outbound Connections
```spl
index=linux_logs
(dest_port IN (4444,1337,9001))
| stats count by host dest_ip dest_port
```

### ğŸ“¡ Windows â€“ Suspicious Network Activity
```spl
index=windows_logs
(EventCode=5156)
| search DestinationPort IN (4444,1337,9001)
| table _time host SourceAddress DestinationAddress DestinationPort
```

### ğŸ“¡ Cloud â€“ Suspicious API Automation
```spl
index=cloud_logs
| stats count by user userAgent
| where count > 500
```

---

## ğŸ”¥ POST-EXPLOITATION

### ğŸ“¦ Data Exfiltration â€“ Linux & Windows
```spl
index=* 
(command IN ("scp","rsync","curl","wget"))
| stats count by user host
| where count > 100
```

### ğŸ“¦ Cloud â€“ Mass Object Downloads
```spl
index=cloud_logs
(eventName IN ("GetObject","Read","storage.objects.get"))
| stats count(object) AS files_downloaded by user
| where files_downloaded > 100
```

### ğŸ’£ Impact â€“ Destructive Actions
```spl
index=cloud_logs
(eventName IN ("DeleteObject","DeleteBucket","storage.objects.delete"))
| table _time user resource
```

---

## ğŸ›¡ï¸ SOC Response & Investigation Notes
- Correlate identity events with storage and host activity
- Validate time-based patterns (bursts, off-hours)
- Check IP reputation and geo anomalies
- Review newly created accounts or service principals
- Contain compromised credentials immediately

---

## ğŸ§  MITRE ATT&CK Mapping (High-Level)

| Phase | Technique |
|------|----------|
| Reconnaissance | T1087, T1046 |
| Initial Access | T1078 |
| Privilege Escalation | T1068 |
| Lateral Movement | T1021 |
| Command & Control | T1071 |
| Exfiltration | T1041 |
| Impact | T1485 |

---

## ğŸ“Œ Summary
This file delivers **advanced, correlated detection coverage** across **Linux, Windows, and Cloud**, enabling SOC teams to monitor the **full attacker lifecycle** from reconnaissance to impact.

