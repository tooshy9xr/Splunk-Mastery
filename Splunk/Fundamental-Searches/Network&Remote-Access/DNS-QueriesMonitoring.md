# ðŸŒ DNS Queries Monitoring â€” Windows & Linux

Detection queries for identifying suspicious, high-risk, or abnormal DNS activity that may indicate malware communication, tunneling, data exfiltration, or command-and-control traffic.

---

# ðŸªŸ Windows â€” DNS Monitoring

## ðŸ”¹ 1. High Volume of DNS Queries  
**Description:** Detects systems generating unusually large numbers of DNS requests.  
**Purpose:** Useful for spotting malware beaconing or misconfigured applications.

**ðŸ” SPL**
```
index=windows sourcetype="Microsoft-Windows-DNS-Client"
| stats count by QueryName, ProcessName, Account_Name, Computer, _time
| where count > 100
```

---

## ðŸ”¹ 2. DNS Queries to Suspicious TLDs  
**Description:** Looks for domains using high-risk top-level domains (e.g., .xyz, .top).  
**Purpose:** Identifies potential C2 communications.

**ðŸ” SPL**
```
index=windows QueryName="*.xyz" OR QueryName="*.top" OR QueryName="*.click"
| stats count by QueryName, ProcessName, Computer, _time
```

---

## ðŸ”¹ 3. DNS Queries from Suspicious Processes  
**Description:** Logs DNS requests generated by scripting engines or unusual executables.  
**Purpose:** Helps detect malware resolving domains.

**ðŸ” SPL**
```
index=windows (ProcessName="powershell.exe" OR ProcessName="cmd.exe" OR ProcessName="wscript.exe" OR ProcessName="cscript.exe")
| stats count by ProcessName, QueryName, Computer, _time
```

---

## ðŸ”¹ 4. Failed DNS Resolutions  
**Description:** Detects repeated failed lookups.  
**Purpose:** Malware often queries non-existent domains.

**ðŸ” SPL**
```
index=windows Status="0x0000232B" OR Status="NXDOMAIN"
| stats count by QueryName, Computer, _time
```

---

# ðŸ§ Linux â€” DNS Monitoring

## ðŸ”¹ 5. DNS Queries Logged via systemd-resolved  
**Description:** Parses DNS requests captured in journal logs.  
**Purpose:** Identifies domains queried by local processes.

**ðŸ” SPL**
```
index=linux "systemd-resolved" "query"
| stats count by host, QueryName, _time
```

---

## ðŸ”¹ 6. DNS Queries from Suspicious Processes (curl, wget, netcat)  
**Description:** Detects command-line utilities initiating DNS lookups.  
**Purpose:** Helps identify data exfiltration or unauthorized communication.

**ðŸ” SPL**
```
index=linux (COMMAND="curl*" OR COMMAND="wget*" OR COMMAND="nc*" OR COMMAND="python*")
| stats count by user, COMMAND, host, QueryName, _time
```

---

## ðŸ”¹ 7. DNS Queries to External or High-Risk Domains  
**Description:** Detects DNS lookups to unusual or known malicious patterns.  
**Purpose:** Identifies beaconing activity.

**ðŸ” SPL**
```
index=linux QueryName="*.xyz" OR QueryName="*.top" OR QueryName="*.space"
| stats count by host, QueryName, _time
```

---

## ðŸ”¹ 8. DNS Tunneling Indicators  
**Description:** Detects abnormally long or encoded DNS queries.  
**Purpose:** Identifies DNS-based data exfiltration.

**ðŸ” SPL**
```
index=linux OR index=windows 
| eval len=len(QueryName)
| where len > 60
| stats count by QueryName, len, host, _time
```
